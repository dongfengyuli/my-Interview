
## 1、TCP/IP协议族

粘包发生在那些情况下？
TCP是端到端传输的，同时TCP连接是可复用的。什么叫复用呢？复用就是一条连接可以供一台主机上的多个进程使用。
**1.**由TCP连接复用造成的粘包问题。
如果没有复用一个连接只提供给端到端的两个进程使用，这是数据的传输方和发送方都是约定好了数据的格式的，但是多个进程使用一个TCP连接，此时多种不同结构的数据进到TCP的流式传输，边界分割肯定会出这样或者那样的问题。
如果利用tcp每次发送数据，就与对方建立连接，然后双方发送完一段数据后，就关闭连接，这样就不会出现粘包问题
连接复用的问题，之后会出一系列TCP文章讲解。所以赶紧关注我😆，防止走丢喔，微信搜索 龙跃十二，即可无忧订阅。
**2.**因为TCP默认会使用Nagle算法，此算法会导致粘包问题。
而Nagle算法主要做两件事，1）只有上一个分组得到确认，才会发送下一个分组；2）收集多个小分组，在一个确认到来时一起发送。
多个分组拼装为一个数据段发送出去，如果没有好的边界处理，在解包的时候会发生粘包问题。
**3.**数据包过大造成的粘包问题。
比如应用进程缓冲区的一条消息的字节的大小超过了发送缓冲区的大小，就有可能产生粘包问题。因为消息已经被分割了，有可能一部分已经被发送出去了，对方已经接受了，但是另外一部分可能刚放入套接口发送缓冲区里准备进一步发送，就直接导致接受的后一部分，直接导致了粘包问题的出现。
**4.**流量控制，拥塞控制也可能导致粘包。
**5.**接收方不及时接收缓冲区的包，造成多个包接收。
大多数人都是知道Nagle算法、接收方不及时处理两种情况造成的粘包问题，但是龙叔必须提醒你，其他几种情况也是非常常见的，面试官也是超爱问，如果你能把其他三种也答出来，面试通过概率大很多。
粘包问题如何处理？
1.Nagle算法问题导致的，需要结合应用场景适当关闭该算法。
2.其他几种情况的处理方法主要分两种：


尾部标记序列。通过特殊标识符表示数据包的边界，例如\n\r，\t，或者一些隐藏字符。


头部标记分步接收。在TCP报文的头部加上表示数据长度。


应用层发送数据时定长发送。